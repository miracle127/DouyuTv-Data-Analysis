# DouyuTv数据分析报告
## 零、数据分析工具
Python
### 主要利用的包：
*  Scrapy 
*  Pandas 
*  Numpy 
*  Pyecharts 
*  Matplotlib

## 一、数据获取
利用Scrapy爬取斗鱼TV、熊猫TV公共api数据，包括当前开播房间列表信息与房间详细信息两部分
爬取频率：30min/次
爬取范围：10月03日----10月15日
## 二、数据结构
### 1.斗鱼TV数据结构：
![][structure1]  
斗鱼在播房间明细与斗鱼房间详细信息是两张表，两张表之间由键roomid相关联。
### 2.熊猫TV数据结构：
![][structure2]  
熊猫数据仅一张表，且由于api不稳定，有约30%的数据确实，在之后的分析中仅日均在线人数的比较中利用到熊猫tv的数据。
## 三、数据预处理
### 1.斗鱼tv与熊猫tv日均在线人数比较数据预处理：
原始数据集为每30min抓取一次，故日均在线人数需按日聚合在线人数数据再进行分析。
### 2.斗鱼tv分时段栏目分析数据预处理：
#### (1).缺失值处理
由于十一期间抓取数据时有一次停电，造成有3小时，共6条数据缺失，按照数据的特性此处不宜采用线性插值法进行插值（不能运用lagrange等插值法），故此处采用缺失值当天前后2天缺失值时段的值求取其均值来进行填充。
#### (2).数据聚合
对斗鱼tv各栏目的分析需要的是各个栏目的指标。因此，对于源数据，需要按照各个主播，聚合成均值。在聚合之前，需要利用键roomid将两张斗鱼数据的表合并。
##### A.对于斗鱼房间详细信息：
按照开播时间将数据聚合，对于其中的各项属性的聚合标准如下表：  

|属性名|聚合标准|
|:---:|:---:|
|owner_weight|按开播时间聚合取该直播时段的初值与终值|
|roomid|唯一值，保留，groupby键之一|
|fans_num|按开播时间聚合取该直播时段的初值与终值|
|start_time|开播时间，groupby的键之一|
|select_time|按开播时间聚合取该直播时段的最后一个值，作为下播时间|

##### B.对于斗鱼在播房间明细：
按照每小时将数据聚合,对于其中的各项属性的聚合标准如下表:

|属性名|聚合标准|
|:---:|:---:|
|zhubo|唯一值，保留|
|Roomid|唯一值，保留，groupby键之一|
|Cate_name|唯一值，保留|
|Cate_id|唯一值，保留|
|Title|唯一值，保留|
|Online|按小时聚合取算术平均数|
|Selecttime|按小时聚合后保留每小时的第一个值，groupby键之一，利用pandas.datetime处理|

##### C.将房间详细信息与在播房间明细合并：
* zhubo、roomid、cate_name、cate_id、title作为单次直播中的唯一值直接保留；
* 以房间详细信息的开播、下播时间为基准作为主播的1次直播，并将该时段内的房间明细表中的online数据再次聚合，返回算术平均数；
* 对于fans_num（粉丝数）与owner_weight（鱼丸体重），分别记录开播与下播时的值作为本次直播的初值与终值；
* 用下播时间减去开播时间，计算出本次直播的直播时长。  
将两张表合并成一张表。该表结构如下图：
![][structure3]
## 四、属性重构
经过数据预处理后，斗鱼在播房间明细与斗鱼房间详细信息两张表已合并为1张表。由于主播一天内可能会直播几次，而每天的开播时间不等，不便进一步分析，故需要构造便于分析的新属性。
首先，定义直播的时段，将一天内的直播按照主播的开播时间分为三个时段：

|时间段|名称|类标记|
|:---|:---:|:---:|
|00:00~07:59|午夜档|0|
|08:00~15:59|白天档|1|
|16:00~24:00|夜间档|2|

然后，去除表中开播时间中的日期，仅保留时间。依据开播时间，将主播的开播/下播时间归纳为时段（午夜档、白天档、夜间档），再以roomid、cate_id、时段为键聚合源数据，构造新属性，作为后续分析的专家数据。

|原属性|重构属性|解释|单位|
|:-:|:-:|:-:|:-:|
|zhubo|zhubo|保留|\|
|roomid|roomid|保留|\|
|cate_id|cate_id|保留|\|
|cate_name|cate_name|保留|\|
|title|直播次数|title本为无用属性，此处用来计数，来确定在某时段直播某栏目的次数|次|
|start_time/over_time|直播时段|根据开播时间确定在哪个时段开播|\|
|粉丝初值/终值|平均粉丝增量|计算出粉丝增量(终值-初值)，并在聚合后计算算术平均数|千人|
|鱼丸初值/终值|平均鱼丸增量|计算出鱼丸增量(终值-初值)，并在聚合后计算算术平均数|kg|
|online|平均在线人数|计算出每个主播某时段直播某栏目时的平均观众数|千人|
|时长|平均直播时长|计算出每个主播某时段直播某栏目时的平均时长|小时|

## 五、数据分析
### 1.斗鱼tv/熊猫tv日均在线人数对比
取每3小时在线总人数的平均数作为分析指标  

![][pic1]  
从图中可以看出斗鱼tv在十一节前后全天时段在线人数均高于熊猫tv。如果api内数据没有人数虚高的问题，那么斗鱼tv的人气是完全高于熊猫tv的。
### 2.斗鱼tv时段重要性分析
以3个时段为基准，聚合专家数据集，分别输出在线人数、粉丝增量、鱼丸增量的均值。  

![][pic2]  
![][pic3]  
![][pic4]  

|时段|在线人数(千人)|鱼丸增量(kg)|粉丝增量(千人)|鱼丸转化率(kg/千人)|粉丝转化率(千粉丝/千人)|
|:-:|:-:|:-:|:-:|:-:|:-:|
|午夜档(00:00~07:59)|646542|39675|1339113|0.0614|2.07|
|白天档(08:00~15:59)|3780843|196543|5974414|0.0518|1.58|
|夜间档(16:00~23:59)|5912982|278622|8029021|0.0471|1.36|

在线人数、鱼丸增量、粉丝增量是衡量直播平台火爆程度的关键指标。在线人数是当前直播平台的活跃用户数量。粉丝增量反应出活跃用户与主播之间的互动程度，    互动程度越高则用户对平台的使用粘性也会提高。鱼丸增量则反应出了用户在平台上的消费程度（当然鱼丸现在主要是作为免费礼物存在，由于无法抓取到鱼翅礼物      的数据，这里还是采用鱼丸来作为用户消费水平的指标）。
 
从图中可以看出。午夜档、白天档与夜间档，在在线人数、鱼丸增量、粉丝增量三个方面都是：夜间档>白天档>午夜档的关系。这也很好解释，在16:00~23:59这个  时间段内上班族与学生都处于休息时段，观看人数也最多，全天在线人数的比例达到了57.13%，鱼丸增量与粉丝增量的占比也是全天最大，但是在这个时段的鱼丸转化率与粉丝转化率却是全天最低的。这是由于晚间档的用户基数最大，但是深度用户占比不大造成的。
 
鱼丸转化率与粉丝转化率的情况与在线人数、鱼丸增量及粉丝增量的情况正好相反，三个时段之间的关系是：午夜档>白天档>夜间档。
 
由此也可以看出，在午夜档深度用户的比重最大，白天档次之，夜间档最少。三个时段中夜间档的休闲用户最多，用户基数最大。因此，也应该投入更多的平台资源在夜间档这个时段，有更大的可能性加大休闲用户的使用程度，增大用户粘性，增加深度用户数量。从而在全天三个时段提升深度用户的总量，达到提升粉丝转化率与鱼丸转化率的目的。


[structure1]:https://github.com/miracle127/DouyuTv-Data-Analysis/blob/master/pictures/斗鱼数据结构.jpg
[structure2]:https://github.com/miracle127/DouyuTv-Data-Analysis/blob/master/pictures/熊猫数据结构.jpg
[structure3]:https://github.com/miracle127/DouyuTv-Data-Analysis/blob/master/pictures/斗鱼数据合并.jpg
[pic1]:https://github.com/miracle127/DouyuTv-Data-Analysis/blob/master/pictures/斗鱼tv_熊猫tv在线人数对比.png
[pic2]:https://github.com/miracle127/DouyuTv-Data-Analysis/blob/master/pictures/斗鱼TV时段人数.png
[pic3]:https://github.com/miracle127/DouyuTv-Data-Analysis/blob/master/pictures/斗鱼TV时段粉丝.png
[pic4]:https://github.com/miracle127/DouyuTv-Data-Analysis/blob/master/pictures/斗鱼TV时段鱼丸.png
